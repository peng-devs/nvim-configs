# 1.1 套件管理器設置企劃書 - lazy.nvim

## 專案概覽
建立現代化的 Neovim 套件管理基礎，使用 lazy.nvim 作為核心套件管理器，實現模組化載入和效能優化。

## 目標與預期成果
- ✅ 建立 lazy.nvim 套件管理系統
- ✅ 實現套件的 lazy loading 機制
- ✅ 建立模組化配置結構
- ✅ 優化 Neovim 啟動時間
- ✅ 為後續套件安裝建立基礎

## 前置需求
- Neovim 0.8+ 版本
- Git (用於套件下載)
- 現有的基本配置 (`lua/core/` 模組)

## 實施步驟

### 步驟 1: 建立 lazy.nvim 引導載入器 ✅
**位置**: `lua/plugins/init.lua`

```lua
-- Bootstrap lazy.nvim (官方推薦的簡潔版本)
local lazypath = vim.fn.stdpath("data") .. "/lazy/lazy.nvim"
if not (vim.uv or vim.loop).fs_stat(lazypath) then
  local lazyrepo = "https://github.com/folke/lazy.nvim.git"
  local out = vim.fn.system({ "git", "clone", "--filter=blob:none", "--branch=stable", lazyrepo, lazypath })
  if vim.v.shell_error ~= 0 then
    vim.api.nvim_echo({
      { "Failed to clone lazy.nvim:\n", "ErrorMsg" },
      { out, "WarningMsg" },
      { "\nPress any key to exit..." },
    }, true, {})
    vim.fn.getchar()
    os.exit(1)
  end
end
vim.opt.rtp:prepend(lazypath)

-- Setup lazy.nvim
require("lazy").setup({
  spec = {
    -- 暫時空的 spec，後續可以加入 plugin 配置
  },
  checker = { enabled = true },
})
```

### 步驟 2: 更新主配置文件 ✅
**位置**: `init.lua`

在現有的 `init.lua` 最後加入：
```lua
-- 載入套件管理器
require('plugins.init')
```

### 步驟 3: 新增套件管理按鍵映射 ✅
**位置**: `lua/core/keymaps.lua` (新增)

```lua
-- 套件管理
vim.keymap.set("n", "<leader>pm", ":Lazy<cr>", { desc = "Open Package Manager" })
```

## 驗證與測試

### 基本功能驗證
1. **健康檢查**:
   ```vim
   :checkhealth lazy
   # 檢查 lazy.nvim 安裝狀態
   ```

2. **套件管理介面測試**:
   ```vim
   :Lazy
   # 應該顯示 lazy.nvim 管理介面
   ```

3. **啟動時間測試**:
   ```bash
   nvim --startuptime startup.log
   # 檢查啟動時間是否合理
   ```

### 效能驗證
- 啟動時間應 < 100ms
- 記憶體使用應保持合理
- 沒有錯誤訊息或警告


## 常見問題與解決方案

### Q1: lazy.nvim 下載失敗
**原因**: 網路連線問題或 Git 配置問題
**解決方案**:
```bash
# 手動下載 lazy.nvim
git clone https://github.com/folke/lazy.nvim.git ~/.local/share/nvim/lazy/lazy.nvim
```

### Q2: 套件載入錯誤
**原因**: 配置語法錯誤或路徑問題
**解決方案**:
1. 檢查 Lua 語法: `:luafile %`
2. 檢查錯誤訊息: `:messages`
3. 重新載入配置: `<leader>sv`

### Q3: 啟動時間過長
**原因**: 套件載入策略不當
**解決方案**:
- 使用 `event` 或 `ft` 進行 lazy loading
- 檢查 `performance.disabled_plugins` 設置
- 使用 `:Lazy profile` 分析載入時間

## 後續步驟
完成此階段後，將為以下套件安裝建立基礎：
1. LSP 系統 (mason.nvim + nvim-lspconfig)
2. 自動完成 (nvim-cmp)
3. 檔案搜尋 (telescope.nvim)
4. 語法高亮 (nvim-treesitter)

## 回滾方案
如果遇到問題，可以：
1. 移除 `lua/plugins/` 目錄
2. 從 `init.lua` 中移除 `require('plugins.init')`
3. 刪除 `~/.local/share/nvim/lazy/` 目錄
4. 重新啟動 Neovim

## 檢查清單
- [✅] lazy.nvim 自動安裝成功
- [✅] 套件管理介面可正常開啟
- [✅] 啟動時間在合理範圍內
- [✅] 無錯誤訊息
- [✅] 按鍵映射正常運作
- [✅] 模組化載入機制運作正常
