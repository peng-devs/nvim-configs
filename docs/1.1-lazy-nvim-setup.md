# 1.1 å¥—ä»¶ç®¡ç†å™¨è¨­ç½®ä¼åŠƒæ›¸ - lazy.nvim

## å°ˆæ¡ˆæ¦‚è¦½
å»ºç«‹ç¾ä»£åŒ–çš„ Neovim å¥—ä»¶ç®¡ç†åŸºç¤ï¼Œä½¿ç”¨ lazy.nvim ä½œç‚ºæ ¸å¿ƒå¥—ä»¶ç®¡ç†å™¨ï¼Œå¯¦ç¾æ¨¡çµ„åŒ–è¼‰å…¥å’Œæ•ˆèƒ½å„ªåŒ–ã€‚

## ç›®æ¨™èˆ‡é æœŸæˆæœ
- âœ… å»ºç«‹ lazy.nvim å¥—ä»¶ç®¡ç†ç³»çµ±
- âœ… å¯¦ç¾å¥—ä»¶çš„ lazy loading æ©Ÿåˆ¶
- âœ… å»ºç«‹æ¨¡çµ„åŒ–é…ç½®çµæ§‹
- âœ… å„ªåŒ– Neovim å•Ÿå‹•æ™‚é–“
- âœ… ç‚ºå¾ŒçºŒå¥—ä»¶å®‰è£å»ºç«‹åŸºç¤

## å‰ç½®éœ€æ±‚
- Neovim 0.8+ ç‰ˆæœ¬
- Git (ç”¨æ–¼å¥—ä»¶ä¸‹è¼‰)
- ç¾æœ‰çš„åŸºæœ¬é…ç½® (`lua/core/` æ¨¡çµ„)

## å¯¦æ–½æ­¥é©Ÿ

### æ­¥é©Ÿ 1: å»ºç«‹ lazy.nvim å¼•å°è¼‰å…¥å™¨
**ä½ç½®**: `lua/plugins/init.lua`

```lua
-- lazy.nvim è‡ªå‹•å®‰è£å’Œåˆå§‹åŒ–
local lazypath = vim.fn.stdpath("data") .. "/lazy/lazy.nvim"
if not vim.loop.fs_stat(lazypath) then
  vim.fn.system({
    "git",
    "clone",
    "--filter=blob:none",
    "https://github.com/folke/lazy.nvim.git",
    "--branch=stable",
    lazypath,
  })
end
vim.opt.rtp:prepend(lazypath)

-- åˆå§‹åŒ– lazy.nvim
require("lazy").setup({
  -- å¥—ä»¶åˆ—è¡¨å°‡åœ¨æ­¤è™•å®šç¾©
}, {
  ui = {
    -- ä½¿ç”¨ unicode åœ–ç¤º
    icons = vim.g.have_nerd_font and {} or {
      cmd = "âŒ˜",
      config = "ğŸ› ",
      event = "ğŸ“…",
      ft = "ğŸ“‚",
      init = "âš™",
      keys = "ğŸ—",
      plugin = "ğŸ”Œ",
      runtime = "ğŸ’»",
      require = "ğŸŒ™",
      source = "ğŸ“„",
      start = "ğŸš€",
      task = "ğŸ“‹",
      lazy = "ğŸ’¤ ",
    },
  },
})
```

### æ­¥é©Ÿ 2: æ›´æ–°ä¸»é…ç½®æ–‡ä»¶
**ä½ç½®**: `init.lua`

```lua
-- Leader key è¨­ç½®å¿…é ˆåœ¨å¥—ä»¶è¼‰å…¥å‰
vim.g.mapleader = ' '
vim.g.maplocalleader = ' '

-- è¼‰å…¥æ ¸å¿ƒé…ç½®
require('core.options')
require('core.keymaps')

-- è¼‰å…¥å¥—ä»¶ç®¡ç†å™¨
require('plugins.init')
```

### æ­¥é©Ÿ 3: å»ºç«‹å¥—ä»¶é…ç½®ç›®éŒ„çµæ§‹
```
lua/plugins/
â”œâ”€â”€ init.lua              # lazy.nvim ä¸»é…ç½®
â”œâ”€â”€ lsp/                  # LSP ç›¸é—œå¥—ä»¶
â”œâ”€â”€ completion/           # è‡ªå‹•å®Œæˆç›¸é—œ
â”œâ”€â”€ ui/                   # ä»‹é¢ç›¸é—œå¥—ä»¶
â”œâ”€â”€ git/                  # Git æ•´åˆå¥—ä»¶
â”œâ”€â”€ treesitter.lua        # èªæ³•é«˜äº®
â””â”€â”€ dap/                  # é™¤éŒ¯å·¥å…·
```

### æ­¥é©Ÿ 4: å»ºç«‹å¥—ä»¶æ¨¡çµ„è¼‰å…¥æ©Ÿåˆ¶
**ä½ç½®**: `lua/plugins/init.lua` (æ›´æ–°ç‰ˆæœ¬)

```lua
local lazypath = vim.fn.stdpath("data") .. "/lazy/lazy.nvim"
if not vim.loop.fs_stat(lazypath) then
  vim.fn.system({
    "git",
    "clone",
    "--filter=blob:none",
    "https://github.com/folke/lazy.nvim.git",
    "--branch=stable",
    lazypath,
  })
end
vim.opt.rtp:prepend(lazypath)

-- æ”¶é›†æ‰€æœ‰å¥—ä»¶é…ç½®
local plugins = {}

-- è‡ªå‹•è¼‰å…¥ plugins ç›®éŒ„ä¸‹çš„æ‰€æœ‰ lua æª”æ¡ˆ
local plugin_files = vim.fn.glob(vim.fn.stdpath('config') .. '/lua/plugins/**/*.lua', false, true)
for _, file in ipairs(plugin_files) do
  local module_name = file:match('.*/lua/plugins/(.*)%.lua$')
  if module_name and module_name ~= 'init' then
    local module_path = 'plugins.' .. module_name:gsub('/', '.')
    local ok, plugin_config = pcall(require, module_path)
    if ok and type(plugin_config) == 'table' then
      if plugin_config[1] then
        -- å¦‚æœæ˜¯å¥—ä»¶åˆ—è¡¨
        vim.list_extend(plugins, plugin_config)
      else
        -- å¦‚æœæ˜¯å–®å€‹å¥—ä»¶é…ç½®
        table.insert(plugins, plugin_config)
      end
    end
  end
end

require("lazy").setup(plugins, {
  ui = {
    icons = vim.g.have_nerd_font and {} or {
      cmd = "âŒ˜",
      config = "ğŸ› ",
      event = "ğŸ“…",
      ft = "ğŸ“‚",
      init = "âš™",
      keys = "ğŸ—",
      plugin = "ğŸ”Œ",
      runtime = "ğŸ’»",
      require = "ğŸŒ™",
      source = "ğŸ“„",
      start = "ğŸš€",
      task = "ğŸ“‹",
      lazy = "ğŸ’¤ ",
    },
  },
  performance = {
    rtp = {
      -- åœç”¨ä¸€äº›ä¸éœ€è¦çš„å…§å»ºå¥—ä»¶
      disabled_plugins = {
        "gzip",
        "tarPlugin",
        "tohtml",
        "tutor",
        "zipPlugin",
      },
    },
  },
})
```

### æ­¥é©Ÿ 5: å»ºç«‹æ¸¬è©¦å¥—ä»¶é…ç½®
**ä½ç½®**: `lua/plugins/ui/which-key.lua` (ç¯„ä¾‹å¥—ä»¶)

```lua
-- which-key.nvim - æŒ‰éµæç¤ºå¥—ä»¶
return {
  "folke/which-key.nvim",
  event = "VimEnter",
  config = function()
    require("which-key").setup({
      plugins = { spelling = true },
      defaults = {},
    })
  end,
}
```

## é©—è­‰èˆ‡æ¸¬è©¦

### åŸºæœ¬åŠŸèƒ½é©—è­‰
1. **å•Ÿå‹•æ¸¬è©¦**:
   ```bash
   nvim --startuptime startup.log
   # æª¢æŸ¥å•Ÿå‹•æ™‚é–“æ˜¯å¦åˆç† (< 100ms)
   ```

2. **å¥—ä»¶ç®¡ç†ä»‹é¢æ¸¬è©¦**:
   ```vim
   :Lazy
   # æ‡‰è©²é¡¯ç¤º lazy.nvim ç®¡ç†ä»‹é¢
   ```

3. **å¥—ä»¶å®‰è£æ¸¬è©¦**:
   ```vim
   :Lazy install
   # å®‰è£æ‰€æœ‰å·²é…ç½®çš„å¥—ä»¶
   ```

### æ•ˆèƒ½é©—è­‰
- å•Ÿå‹•æ™‚é–“æ‡‰ < 100ms
- è¨˜æ†¶é«”ä½¿ç”¨æ‡‰ä¿æŒåˆç†
- æ²’æœ‰éŒ¯èª¤è¨Šæ¯æˆ–è­¦å‘Š

## æŒ‰éµæ˜ å°„

### æ–°å¢å¥—ä»¶ç®¡ç†ç›¸é—œæŒ‰éµ
**ä½ç½®**: `lua/core/keymaps.lua` (æ–°å¢)

```lua
-- å¥—ä»¶ç®¡ç†
vim.keymap.set("n", "<leader>pm", ":Lazy<cr>", { desc = "é–‹å•Ÿå¥—ä»¶ç®¡ç†å™¨" })
vim.keymap.set("n", "<leader>pi", ":Lazy install<cr>", { desc = "å®‰è£å¥—ä»¶" })
vim.keymap.set("n", "<leader>pu", ":Lazy update<cr>", { desc = "æ›´æ–°å¥—ä»¶" })
vim.keymap.set("n", "<leader>pc", ":Lazy clean<cr>", { desc = "æ¸…ç†å¥—ä»¶" })
vim.keymap.set("n", "<leader>ps", ":Lazy sync<cr>", { desc = "åŒæ­¥å¥—ä»¶" })
```

## å¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

### Q1: lazy.nvim ä¸‹è¼‰å¤±æ•—
**åŸå› **: ç¶²è·¯é€£ç·šå•é¡Œæˆ– Git é…ç½®å•é¡Œ
**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æ‰‹å‹•ä¸‹è¼‰ lazy.nvim
git clone https://github.com/folke/lazy.nvim.git ~/.local/share/nvim/lazy/lazy.nvim
```

### Q2: å¥—ä»¶è¼‰å…¥éŒ¯èª¤
**åŸå› **: é…ç½®èªæ³•éŒ¯èª¤æˆ–è·¯å¾‘å•é¡Œ
**è§£æ±ºæ–¹æ¡ˆ**:
1. æª¢æŸ¥ Lua èªæ³•: `:luafile %`
2. æª¢æŸ¥éŒ¯èª¤è¨Šæ¯: `:messages`
3. é‡æ–°è¼‰å…¥é…ç½®: `<leader>sv`

### Q3: å•Ÿå‹•æ™‚é–“éé•·
**åŸå› **: å¥—ä»¶è¼‰å…¥ç­–ç•¥ä¸ç•¶
**è§£æ±ºæ–¹æ¡ˆ**:
- ä½¿ç”¨ `event` æˆ– `ft` é€²è¡Œ lazy loading
- æª¢æŸ¥ `performance.disabled_plugins` è¨­ç½®
- ä½¿ç”¨ `:Lazy profile` åˆ†æè¼‰å…¥æ™‚é–“

## å¾ŒçºŒæ­¥é©Ÿ
å®Œæˆæ­¤éšæ®µå¾Œï¼Œå°‡ç‚ºä»¥ä¸‹å¥—ä»¶å®‰è£å»ºç«‹åŸºç¤ï¼š
1. LSP ç³»çµ± (mason.nvim + nvim-lspconfig)
2. è‡ªå‹•å®Œæˆ (nvim-cmp)
3. æª”æ¡ˆæœå°‹ (telescope.nvim)
4. èªæ³•é«˜äº® (nvim-treesitter)

## å›æ»¾æ–¹æ¡ˆ
å¦‚æœé‡åˆ°å•é¡Œï¼Œå¯ä»¥ï¼š
1. ç§»é™¤ `lua/plugins/` ç›®éŒ„
2. å¾ `init.lua` ä¸­ç§»é™¤ `require('plugins.init')`
3. åˆªé™¤ `~/.local/share/nvim/lazy/` ç›®éŒ„
4. é‡æ–°å•Ÿå‹• Neovim

## æª¢æŸ¥æ¸…å–®
- [ ] lazy.nvim è‡ªå‹•å®‰è£æˆåŠŸ
- [ ] å¥—ä»¶ç®¡ç†ä»‹é¢å¯æ­£å¸¸é–‹å•Ÿ
- [ ] å•Ÿå‹•æ™‚é–“ < 100ms
- [ ] ç„¡éŒ¯èª¤è¨Šæ¯
- [ ] æŒ‰éµæ˜ å°„æ­£å¸¸é‹ä½œ
- [ ] æ¨¡çµ„åŒ–è¼‰å…¥æ©Ÿåˆ¶é‹ä½œæ­£å¸¸